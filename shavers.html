<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title></title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="">
	<script src="https://thunkable.github.io/webviewer-extension/thunkableWebviewerExtension.js"
		type="text/javascript"></script>
<style>

	span {
		font-size: 10px;
	}
</style>
</head>

<body>
	<!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
	<span id="result">results here</span>
	<script>

		function toRad(v) { return v * Math.PI / 180; }
		function kmToMiles(km) { return (km * 0.62137).toFixed(2); }

		var l2 = LatLong(-85, 42);


		function LatLong(lat, lon) {
			return { Latitude: lat, Longitude: lon }
		}

		function haversine(l1, l2) {
			var R = 6371; /*km*/
			var x1 = l2.Latitude - l1.location[0];
			var dLat = toRad(x1);
			var x2 = l2.Longitude - l1.location[1];
			var dLon = toRad(x2);
			var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
				Math.cos(toRad(l1.location[0])) * Math.cos(toRad(l2.Latitude)) *
				Math.sin(dLon / 2) * Math.sin(dLon / 2);
			var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
			var d = R * c;
			return d;
		}


		ThunkableWebviewerExtension.receiveMessage(function (message) {
			//ThunkableWebviewerExtension.postMessage(message);

				var messageList = JSON.parse(message);
				var index = messageList.index
				var data = messageList.Locations
				var whatisit = typeof data;
				
				
				var returnObjects = [];
				data.forEach(element => {
					if (kmToMiles(haversine(element, l2)) > 10) {
						returnObjects.push(element.City + ' is ' + kmToMiles(haversine(element, l2)) + ' f away');
					}
				});
				
				document.getElementById("result").innerHTML = returnObjects;
				ThunkableWebviewerExtension.postMessage(returnObjects);


			//parse string from app into JSON object
		//setTimeout(function () {

		//	}, 250);

		});






	</script>
</body>

</html>