<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title></title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="">
	<script src="https://thunkable.github.io/webviewer-extension/thunkableWebviewerExtension.js"
		type="text/javascript"></script>

</head>

<body>
	<!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
	<span id="result">results here</span>
	<script>

		function toRad(v) { return v * Math.PI / 180; }
		function kmToMiles(km) { return (km * 0.62137).toFixed(2); }

		var l2 = LatLong(-85, 42);


		function LatLong(lat, lon) {
			return { Latitude: lat, Longitude: lon }
		}

		function haversine(l1, l2) {
			var R = 6371; /*km*/
			var x1 = l2.Latitude - l1.location[0];
			var dLat = toRad(x1);
			var x2 = l2.Longitude - l1.location[1];
			var dLon = toRad(x2);
			var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
				Math.cos(toRad(l1.location[0])) * Math.cos(toRad(l2.Latitude)) *
				Math.sin(dLon / 2) * Math.sin(dLon / 2);
			var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
			var d = R * c;
			return d;
		}

		var handful = [{ "City": "Homs", "Country": "Syria", "location({\"constraints\":[],\"type\":\"POINT\",\"srsId\":4326})": "POINT(36.72 34.73)", "population": 1005000, "location": [36.72, 34.73] }, { "City": "Cologne", "Country": "Germany", "location({\"constraints\":[],\"type\":\"POINT\",\"srsId\":4326})": "POINT(6.95 50.93)", "population": 1004000, "location": [6.95, 50.93] }, { "City": "Qinhuangdao", "Country": "China", "location({\"constraints\":[],\"type\":\"POINT\",\"srsId\":4326})": "POINT(119.62 39.9304)", "population": 1003000, "location": [119.62, 39.9304] }, { "City": "Fès", "Country": "Morocco", "location({\"constraints\":[],\"type\":\"POINT\",\"srsId\":4326})": "POINT(-5.0004 34.0546)", "population": 1002000, "location": [-5.0004, 34.0546] }, { "City": "Yongzhou", "Country": "China", "location({\"constraints\":[],\"type\":\"POINT\",\"srsId\":4326})": "POINT(111.62 26.2304)", "population": 1000000, "location": [111.62, 26.2304] }, { "City": "Baoshan", "Country": "China", "location({\"constraints\":[],\"type\":\"POINT\",\"srsId\":4326})": "POINT(99.15 25.12)", "population": 1000000, "location": [99.15, 25.12] }, { "City": "Aden", "Country": "Yemen", "location({\"constraints\":[],\"type\":\"POINT\",\"srsId\":4326})": "POINT(45.0095 12.7797)", "population": 1000000, "location": [45.0095, 12.7797] }, { "City": "Quảng Hà", "Country": "Vietnam", "location({\"constraints\":[],\"type\":\"POINT\",\"srsId\":4326})": "POINT(108.25 16.06)", "population": 1000000, "location": [108.25, 16.06] }, { "City": "Cochabamba", "Country": "Bolivia", "location({\"constraints\":[],\"type\":\"POINT\",\"srsId\":4326})": "POINT(-66.17 -17.41)", "population": 1000000, "location": [-66.17, -17.41] }]

		ThunkableWebviewerExtension.receiveMessage(function (message) {
			//start
			setTimeout(function () {
				ThunkableWebviewerExtension.postMessage('start');
			}, 0);

			//set variable from message
			setTimeout(function () {
				var other = message
				ThunkableWebviewerExtension.postMessage('other Set');
			}, 500);

			
			setTimeout(function () {
				var messageList = JSON.parse(message);
				ThunkableWebviewerExtension.postMessage(messageList);
			}, 1000);

			
			setTimeout(function () {
				var object = messageList.Locations;
				ThunkableWebviewerExtension.postMessage(object);
			}, 1500);

			setTimeout(function () {
				var returnObjects = [];
				ThunkableWebviewerExtension.postMessage('create empty array');
			}, 2000);

			setTimeout(function () {
				document.getElementById("result").innerHTML = messageList;
				ThunkableWebviewerExtension.postMessage('done');
			}, 2500);


		});






	</script>
</body>

</html>